-- [[ 6. OCEAHUB DISCORD REPORTING SYSTEM ]]
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local WEBHOOK_URL = "https://discord.com/api/webhooks/1474178919987937462/QLMSj1_R1vH8iLP7QEiLoHrULzEGFb-la0LeT_NPveSojTVop2gihP6CUdVsv2mx_ZqL"

local function GetRealAvatar(userId)
    local api = "https://thumbnails.roproxy.com/v1/users/avatar-headshot?userIds="..userId.."&size=150x150&format=Png&isCircular=false"
    local success, response = pcall(function() return game:HttpGet(api) end)
    if success then
        local data = HttpService:JSONDecode(response)
        if data and data.data and data.data[1] and data.data[1].imageUrl then
            return data.data[1].imageUrl
        end
    end
    return "https://www.roblox.com/headshot-thumbnail/image?userId="..userId.."&width=150&height=150&format=png"
end

local function SendOceaStatus()
    local lp = LocalPlayer
    if not lp then return end
    
    local avatarUrl = GetRealAvatar(lp.UserId)
    local currentPing = "N/A"
    local currentClumsy = "0ms"
    
    pcall(function()
        currentPing = math.floor(lp:GetNetworkPing() * 1000) .. "ms"
        currentClumsy = (settings().Network.IncomingReplicationLag * 1000) .. "ms"
    end)
    
    -- OceaHub Reach AyarlarÄ± (_G.PartDistances)
    local ft = _G.PartDistances or {}
    local function getVal(name) return (ft[name] and ft[name] > 0) and "Active âœ…" or "Passive âŒ" end
    local function getDist(name) return ft[name] or "0" end

    local reachDisplay = string.format(
        "ğŸ¦µ **Right Leg:** %s (`%s`)\nğŸ¦µ **Left Leg:** %s (`%s`)\nğŸ‘• **Torso:** %s (`%s`)\nğŸ‘¤ **Head:** %s (`%s`)\nğŸ§¤ **GK Touch:** %s (`%s`)",
        getVal("Right Leg"), getDist("Right Leg"),
        getVal("Left Leg"), getDist("Left Leg"),
        getVal("Torso"), getDist("Torso"),
        getVal("Head"), getDist("Head"),
        getVal("GK"), getDist("GK")
    )

    local payload = {
        ["embeds"] = {{
            ["title"] = "ğŸŒŠ OceaHub Report - Oyuncu: " .. lp.Name,
            ["color"] = 0x00A2FF,
            ["thumbnail"] = { ["url"] = avatarUrl },
            ["fields"] = {
                {["name"] = "ğŸ“ Reach (FireTouch) Mesafeleri", ["value"] = reachDisplay, ["inline"] = false},
                {["name"] = "âš¡ Ocea React", ["value"] = "`" .. (ReactActivated and "ON" or "OFF") .. " (" .. (ReactDist or 5) .. " Studs)`", ["inline"] = true},
                {["name"] = "ğŸš€ Real Ping", ["value"] = "`" .. currentPing .. "`", ["inline"] = true},
                {["name"] = "ğŸ¥´ MS Boost", ["value"] = "`" .. currentClumsy .. "`", ["inline"] = true} 
            },
            ["footer"] = {["text"] = "OceaHub: FTP Edition"},
            ["timestamp"] = os.date("!%Y-%m-%dT%H:%M:%SZ")
        }}
    }

    local requestFunc = (syn and syn.request) or (http and http.request) or http_request or request
    if requestFunc then
        pcall(function()
            requestFunc({
                Url = WEBHOOK_URL,
                Method = "POST",
                Headers = {["Content-Type"] = "application/json"},
                Body = HttpService:JSONEncode(payload)
            })
        end)
    end
end

-- 5 dakikada bir Discord'a rapor atar
task.spawn(function()
    while true do
        SendOceaStatus()
        task.wait(300)
    end
end)

-- Ä°lk aÃ§Ä±lÄ±ÅŸta gÃ¶nder
task.delay(2, function() SendOceaStatus() end)
